{"version":3,"sources":["../../../../../assets/src/utils/assets/src/utils/NextHttp.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../assets/src/utils","sourcesContent":["export class NextHttp {\n    private serverAddress = \"https://127.0.0.1:1323/\";\n    private action: IApiMethod;\n    private api: string;\n    private apiParams: IApiParams;\n    private token: string = '';\n    private successCallback: IApiSuccessFunction;\n    private errorCallback: IApiErrorFunction;\n    private metaCallback: IApiMetaFunction;\n\n    public constructor(serverAddress?:string) {\n        if(serverAddress){\n            this.serverAddress = serverAddress;\n        }\n    }\n\n    public updateToken(token:string) {\n        this.token = token;\n    }\n\n    public get(name: string, params: IApiParams, successCb?: IApiSuccessFunction, errorCb?: IApiErrorFunction){\n        this.action = 'get';\n        this.api = name;\n        this.apiParams = params;\n        this.successCallback = successCb;\n        this.errorCallback = errorCb;\n        this.send();\n    }\n\n    public post(name: string, params: IApiParams, successCb?: IApiSuccessFunction, errorCb?: IApiErrorFunction){\n        this.action = 'post';\n        this.api = name;\n        this.apiParams = params;\n        this.successCallback = successCb;\n        this.errorCallback = errorCb;\n        this.send();\n    }\n\n    private dealWithMeta(meta: Object) {\n\n    }\n\n    private send() {\n        // 参数检查\n        if (!this.action) throw new Error('Api action is not given!');\n        if (!this.api) throw new Error('Api name is not given!');\n        let action = this.action;\n        let api = this.api;\n        let params = this.apiParams || {};\n        let token = this.token;\n        let url = this.serverAddress + api;\n        if (token && !params.hasOwnProperty('token')) {\n            // params[\"_token\"] = token;\n        }\n\n        // 初始化XMLHttpRequest\n        let xmlHttp = new XMLHttpRequest();\n        let append = '';\n\n        for (let key in params) {\n            if (params.hasOwnProperty(key)) {\n                if (append !== '') {\n                    append += '&';\n                }\n                let param = params[key];\n                param = typeof param === \"object\" ? JSON.stringify(param) : param;\n                // URL发送数据时，+号和&号会丢失，因此应在发送前转换\n                if (typeof param === \"string\") {\n                    param = param.replace(/\\+/g, '%2B');\n                    param = param.replace(/&/g, '%26');\n                    param = encodeURIComponent(param);\n                }\n                append += key + '=' + param;\n            }\n        }\n\n        if (action === 'post') {\n            xmlHttp.open(action, url);\n        } else {\n            if (append !== '') {\n                xmlHttp.open(action, url + '?' + append);\n            } else {\n                xmlHttp.open(action, url);\n            }\n        }\n        xmlHttp.setRequestHeader('Authorization', 'Bearer ' + token);\n        xmlHttp.onreadystatechange = () => {\n            if (xmlHttp.readyState === 4) {\n                if (xmlHttp.status === 200) {\n                    let strData;\n                    // 若有返回结果\n                    if (xmlHttp.responseText.length >= 0) {\n                        try {\n                            strData = JSON.parse(xmlHttp.responseText);\n                        } catch (e) {\n                            cc.log('Response data is not in JSON format!');\n                            // Helper.log(xmlHttp.responseText);\n                        }\n                        // 若成功解析返回的数据\n                        if (strData) {\n                            // data: api返回数据的主要内容\n                            // meta: api返回的元数据，比如游戏状态改变，分页信息等等\n                            // error: api返回的错误信息\n                            let data, meta, error;\n                            if (strData.hasOwnProperty('meta') && strData['meta'] !== null) {\n                                meta = strData['meta'];\n                                this.dealWithMeta(meta);\n                            }\n                            if (strData.hasOwnProperty('data') && strData['data'] !== null) {\n                                if (this.successCallback) {\n                                    this.successCallback(strData['data']);\n                                }\n                            }\n                            if (strData.hasOwnProperty('error') && strData['error'] !== null) {\n                                error = strData['error'];\n                                if (this.errorCallback) {\n                                    this.errorCallback(error);\n                                } else {\n                                    cc.log('Unhandled Api Error!');\n                                }\n                            }\n                        } else {\n                            cc.log('Server Error!');\n                        }\n                    } else {\n                        cc.log('Can\\'t get the response data.');\n                        if (this.errorCallback) {\n                            this.errorCallback();\n                        }\n                    }\n                } else { //其它http状态码处理\n                    cc.log(xmlHttp.responseText);\n                }\n            } else { //其它request状态处理\n            }\n        };\n        if (action === 'post') {\n            xmlHttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n            xmlHttp.send(append);\n        } else {\n            xmlHttp.send();\n        }\n    }\n\n}"]}